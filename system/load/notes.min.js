$(function(){loginsys()});function review(e){$("div.login").addClass("disable"),$("div.noteview").addClass("disable"),$("div.noteslist").addClass("disable"),$("div.globalloader").addClass("disable"),$("div."+e).removeClass("disable")}function errorMessage(e,r){void 0===r&&(r=10),$("div.global.error.message").html(e),$("div.global.error.message").removeClass("disable"),null!==errorMessageTimeOut&&clearTimeout(errorMessageTimeOut),!1!==r&&(errorMessageTimeOut=setTimeout(function(){$("div.global.error.message").addClass("disable")},1e3*r))}function ajax_request(e,r,s,o){$.post(domain+"/ajax.php?"+e,r,function(e){"object"==typeof e?("error"===e.status?console.log(e.error):errorMessage("",0),"function"==typeof s&&s(e)):(errorMessage("Sever antwortet nicht korrekt!",!1),"function"==typeof o&&o(e))}).fail(function(){errorMessage("Verbindung zum Sever verloren!",!1),"function"==typeof o&&o({})})}var userinformation={name:null,id:null,admin:!1},errorMessageTimeOut=null;function loginsys(){function i(){var i=window.location.hash;if(""!=i){i=i.substr(1);if(new RegExp("[a-z]+:[a-z0-9]+").test(i)){var o=i.split(":"),n=o[0],s=o[1];console.log('Versuche User "'+n+'" mit Loginlink einzuloggen.'),$("div.login div.input div.loading").removeClass("disable"),ajax_request("login",{username:n,authcode:s},function(i){$("div.login div.input div.loading").addClass("disable"),"okay"===i.status?(userinformation.name=n,userinformation.id=i.data.id,userinformation.admin=i.data.admin,localStorage.setItem("userinformation_id",userinformation.id),localStorage.setItem("userinformation_name",userinformation.name),localStorage.setItem("userinformation_admin",userinformation.admin),a(),list()):e()})}else e()}else e()}function e(){function i(){$("div.login div.input div.loading").removeClass("disable"),$("div.login div.input div#loginform").addClass("disable"),$("div.login p.message.important").addClass("disable");var i=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash($("input#userpassword").val()));ajax_request("login",{username:$("input#username").val(),password:i},function(i){$("div.login div.input div.loading").addClass("disable"),"error"===i.status?($("div.login p.message.error").removeClass("disable"),$("div.login div.input div#loginform").removeClass("disable")):"okay"===i.status&&($("div.login p.message.okay").removeClass("disable"),$("div.login p.message.error").addClass("disable"),$("div.login div.input").addClass("disable"),$("input#username").val(""),$("input#userpassword").val(""),userinformation.name=i.data.name,userinformation.id=i.data.id,userinformation.admin=i.data.admin,localStorage.setItem("userinformation_id",userinformation.id),localStorage.setItem("userinformation_name",userinformation.name),localStorage.setItem("userinformation_admin",userinformation.admin),a(),list())})}$("div.login p.message.important").removeClass("disable"),$("div.login p.message.error").addClass("disable"),$("div.login p.message.okay").addClass("disable"),$("div.login div.input div.loading").addClass("disable"),$("div.login div.input div#loginform").removeClass("disable"),$("div.login div.input").removeClass("disable"),$("button#userlogin").unbind("click").click(i),$("input#userpassword").unbind("keyup").keyup(function(e){13==e.keyCode&&i()})}function a(){function i(){ajax_request("login",{logout:null},function(i){"okay"===i.status&&($("p.message.error.loggedout").removeClass("disable"),setTimeout(function(){$("p.message.error.loggedout").addClass("disable")},2e4))}),0==$("input#logouttype:checked").length?localStorage.clear():(localStorage.removeItem("userinformation_id"),localStorage.removeItem("userinformation_name")),userinformation={name:null,id:null,admin:!1},window.location.hash="",null!==e&&clearInterval(e),errorMessage("Fehler!",0),"undefined"!=typeof cm_editor&&cm_editor.setValue("empty"),["input#userpassword","input#username","input#notename","div#notespreview","textarea#notesinput","input#newnotename","div.listpart div.list"].forEach(function(i){$(i).empty(),"textarea#notesinput"!==i&&$(i).val("")}),$("div.logout").addClass("disable"),loginsys()}var e=null;$("div.logout").removeClass("disable"),$("button#logout").unbind("click").click(i),e=setInterval(function(){ajax_request("login",{status:userinformation.id},function(i){1!=i.data&&errorMessage("Die Session ist abgelaufen!",!1)})},3e5),$("div.logout span.usertools").tooltip(),userinformation.admin?($("div.logout span.usertools span.ui-icon-wrench").removeClass("disable"),$("div.logout span.usertools span.ui-icon-wrench").unbind("click").click(function(){$.ajax({type:"GET",url:domain+"/load/backend."+jsdevmin+".js",success:function(){adminDialog()},dataType:"script",cache:!0})})):$("div.logout span.usertools span.ui-icon-wrench").addClass("disable"),$("div.logout span.usertools span.ui-icon-person").unbind("click").click(function(){authCodeManager()})}!function(){function e(){review("login"),""!=localStorage.getItem("userinformation_id")&&null!=localStorage.getItem("userinformation_id")&&""!=localStorage.getItem("userinformation_name")&&null!=localStorage.getItem("userinformation_name")?(userinformation.id=localStorage.getItem("userinformation_id"),userinformation.name=localStorage.getItem("userinformation_name"),userinformation.admin=JSON.parse(localStorage.getItem("userinformation_admin")),$("div.login div.input div.loading").removeClass("disable"),ajax_request("login",{status:userinformation.id},function(e){$("div.login div.input div.loading").addClass("disable"),1==e.data?(a(),list()):i()})):i()}review("globalloader");var o=window.location.hash;""!=o?(o=o.substr(1),new RegExp("[^A-Za-z0-9]").test(o)?e():shareviewer(o,e)):e()}()}function list(){review("noteslist"),$("div.noteslist div.listpart div.loading").removeClass("disable"),ajax_request("list",{userid:userinformation.id},function(t){$("div.noteslist div.listpart div.loading").addClass("disable"),"okay"===t.status&&function(t){$("button#newnote").unbind("click").click(function(){var t=$("input#newnotename").val();""!=t&&function(t){$("div.noteslist div.listpart div.loading").removeClass("disable"),ajax_request("list",{userid:userinformation.id,name:t},function(i){$("div.noteslist div.listpart div.loading").addClass("disable"),"okay"===i.status&&(console.log('Notiz: "'+t+'" ("'+i.data.id+'") angelegt.'),list())})}(t)}),$("button#notesarchive").unbind("click").click(function(){oldNotesManager()});var i="<ul>";$.each(t,function(s,n){i+='<li class="noteslist_notesnames box" noteid="'+n.noteid+'"><span class="notesnames">'+n.name+'</span> <span class="noteseditbuttons"><button art="up" title="Nach oben" '+(0!=s?"":'disabled="disabled"')+'>&uarr;</button><button art="down" title="Nach unten" '+(t.length-1!=s?"":'disabled="disabled"')+'>&darr;</button><button art="del" title="Notiz archivieren">&#x21bb;</button></span></li>'}),i+="</ul>",$("div.noteslist div.listpart div.list").html(i),$("li.noteslist_notesnames").tooltip(),$("div.noteslist div.listpart div.list ul").css({"list-style-type":"none"}),$("div.noteslist div.listpart div.list ul li.noteslist_notesnames").css({"line-height":"28px"}),$("span.noteseditbuttons").css({float:"right",cursor:"pointer"}),$("div.noteslist div.listpart div.list ul li span.notesnames").css({display:"inline-block",cursor:"pointer"}),$("div.noteslist div.listpart div.list ul li span.notesnames").unbind("click").click(function(){var t=$(this).parent().attr("noteid"),i=$(this).text();console.log('Oeffne: "'+i+'" ("'+t+'")'),maker(t,i)}),$("span.noteseditbuttons button").unbind("click").click(function(){var t=$(this).attr("art"),i=$(this).parent().parent().attr("noteid");$("div.noteslist div.listpart div.loading").removeClass("disable"),ajax_request("list",{userid:userinformation.id,art:t,noteid:i},function(s){$("div.noteslist div.listpart div.loading").addClass("disable"),"okay"===s.status&&(console.log('Notiz: "'+i+'" wurde '+("del"==t?"gelöscht":"up"==t?"nach oben verschoben":"nach unten verschoben")),list())})})}(t.data)})}function maker(e,t,i,a){function n(){$("input#notename").val(u.name),$("textarea#notesinput").text(u.content),"object"!=typeof cm_editor?cm_editor=CodeMirror.fromTextArea(document.getElementById("notesinput"),{mode:"gfm",lineNumbers:!0,theme:"default"}):cm_editor.setValue($("textarea#notesinput").val()),function(){function e(e,t){var i=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent);if(i&&void 0!==t&&1===t.text.length&&/^[A-Z]$/.test(t.text[0])){var a=$(":focus");a.blur(),a.focus()}$("div#notespreview").html(marked(cm_editor.getValue()))}var t=new marked.Renderer;t.heading=function(e,t){return"<h"+(t+2)+">"+e+"</h"+(t+2)+">"},t.link=function(e,t,i){return'<a href="'+e+'" title="'+t+'" target="_blank">'+i+"</a>"},marked.setOptions({renderer:t,gfm:!0,tables:!0,highlight:function(e,t){if("tex"!=t)return-1!==["markup","css","clike","javascript","c","bash","cpp","csharp","ruby","git","ini","java","json","lua","markdown","matlab","objectivec","perl","php","python","r","sql","swift"].indexOf(t)?Prism.highlight(e,Prism.languages[t]):e;try{return katex.renderToString(e)}catch(e){return'<span style="color:red;">'+e.message+"</span>"}}});e(),l&&!s?$("div.input.box").addClass("disable"):($("div.input.box").removeClass("disable"),cm_editor.on("change",e));c=e}(),function(){function e(){var e={name:$("input#notename").val(),id:u.id,content:cm_editor.getValue()};localStorage.setItem("note_autosave_"+u.id,JSON.stringify(e)),Date.now()-3e4>b&&o()}e(),cm_editor.on("change",e),g=e}()}function o(i){function n(){l&&s?(b=Date.now(),a(cm_editor.getValue(),!1)):!1===l&&($("div.noteview div.loading").removeClass("disable"),ajax_request("view",{userid:userinformation.id,noteid:e,note:{name:$("input#notename").val(),cont:cm_editor.getValue()}},function(a){$("div.noteview div.loading").addClass("disable"),"okay"===a.status&&(console.log('Notiz: "'+t+'" ("'+e+'") auf Server gespeichert.'),b=Date.now()),"function"==typeof i&&i("okay"===a.status)},function(e){"function"==typeof i&&i(!1)}))}v?($("body").append('<div id="dangerMessageNoteSave">Beim Speichern der Notiz kann es eventuell zu Datenverlust kommen, da die aktuellste Version nicht vom Server geladen werden konnte!</div>'),$("#dangerMessageNoteSave").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:"Gefahr des Datenverlustes!",buttons:{"Trotzdem Speichern":function(){$(this).dialog("close"),v=!1,n()},"Erstmal nicht":function(){$(this).dialog("close")}},close:function(){$(this).remove()}})):n()}function d(){function t(){errorMessage("Freigaben konnten nicht geladen werden."),$("div.noteview div.loading").addClass("disable")}$("div.noteview div.loading").removeClass("disable"),ajax_request("view",{userid:userinformation.id,noteid:e},function(i){if("okay"===i.status){var a='<div class="message error freigabeDialog disable">Konnte Aktion nicht durchführen.</div><table><tr><th>Link</th><th>Name</th><th>Erstellt</th><th>Bearbeiten</th><th>Letzter Aufruf (Anzahl)</th><th>Löschen</th></tr>',n=!1;$.each(i.data,function(e,t){n=!0,a+='<tr><td><a href="'+domain+"/#"+t.authcode+'" target="_blank" style="color:lightblue;">Aufrufen</a> <button authcode="'+t.authcode+'" class="freigabeQR">QR-Code</button></td>',a+="<td>"+t.name+"</td>",a+="<td>"+t.created+"</td>",a+='<td><code style="color:black;">'+t.edit+"</code></td>",a+="<td>"+t.lastAccessed+" ("+t.accesses+")</td>",a+='<td><button authcode="'+t.authcode+'" class="deleteFreigabe">Löschen</button></td></tr>'}),a+="</table>",!1===n&&(a+="<p>Noch keine Freigaben!</p>"),a+='<h3>Neue Freigabe</h3><div class="loading freigabeDialog disable"></div><input type="text" placeholder="Name" id="freigabeManagerNewName"><br /><input type="radio" id="freigabeManagerNewEdit" name="freigabeManagerNewEdit" value="true"> Bearbeiten erlauben <input type="radio" id="freigabeManagerNewEdit" name="freigabeManagerNewEdit" value="false" checked="checked"> Nur lesen <br /><button id="addFreigabe">Erstellen</button>',$("body").append('<div id="freigabeManagerDialog">'+a+"</div>"),$("div.noteview div.loading").addClass("disable"),$("div#freigabeManagerDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:"Freigaben",close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}}),$("button.deleteFreigabe").click(function(){var t=$(this).attr("authcode");$("div.freigabeDialog.loading").removeClass("disable"),ajax_request("view",{userid:userinformation.id,noteid:e,share:{authcode:t,edit:"leer",name:"leer"}},function(e){"okay"===e.status?($("div#freigabeManagerDialog").dialog("close"),d()):($("div.freigabeDialog.loading").addClass("disable"),$("div.freigabeDialog.error").removeClass("disable"))})}),$("button#addFreigabe").click(function(){var t=$("input#freigabeManagerNewName").val(),i="true"==$("input#freigabeManagerNewEdit:checked").val();""!=t&&($("div.freigabeDialog.loading").removeClass("disable"),ajax_request("view",{userid:userinformation.id,noteid:e,share:{authcode:"leer",edit:i,name:t}},function(e){"okay"===e.status?($("div#freigabeManagerDialog").dialog("close"),d()):($("div.freigabeDialog.loading").addClass("disable"),$("div.freigabeDialog.error").removeClass("disable"))}))}),$("button.freigabeQR").click(function(){var e=$(this).attr("authcode"),t=domain+"/#"+e,i='<p><b>Code:</b> <code style="color:black;">'+e+'</code></p><p><b>URL:</b> <input type="text" value="'+t+'" readonly="readonly" style="width:90%;"></p><p><b>Link:</b> <a href="'+t+'" target="_blank" style="color:lightblue;">Aufrufen</a></p><p><center><div style="background-color:white; padding:15px; border-radius:5px;" id="freigabeManagerQR"></div></center></p>';$("body").append('<div id="freigabeManagerQRDialog">'+i+"</div>"),$("div#freigabeManagerQRDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:"Freigabelink",close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}}),new QRCode(document.getElementById("freigabeManagerQR"),t)})}else t()},t)}function r(){function t(){errorMessage("Notizverlauf konnte nicht geladen werden."),$("div.noteview div.loading").addClass("disable")}$("div.noteview div.loading").removeClass("disable"),ajax_request("view",{userid:userinformation.id,noteid:e,history:3},function(e){if("okay"===e.status){var i="<table><tr><th>Änderungen</th><th>Zeitpunkt</th></tr>";$.each(e.data,function(e,t){i+="<tr><td>"+t.diff+"</td>",i+="<td>"+t.time+'<button key="'+e+'" class="takeInputFromHistory">Zurückkehren</button></td></tr>'}),i+="</table>",$("body").append('<div id="historyManagerDialog">'+i+"</div>"),$("div.noteview div.loading").addClass("disable"),$("div#historyManagerDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:"Notizverlauf",close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}}),$("button.takeInputFromHistory").click(function(){var t=$(this).attr("key"),i=e.data[t].text;cm_editor.setValue(i),$("div#historyManagerDialog").dialog("close")})}else t()},t)}if(void 0===i)var l=!1,s=!1;else{if("function"==typeof a)s=!0;else s=!1;l=!0}review("noteview");var u,c,g,v=!1,b=0;!function(){function a(i){i||(v=!0,errorMessage("Kann die aktuelle Version der Notiz nicht vom Server holen.",20)),null!=localStorage.getItem("note_autosave_"+e)?(u=JSON.parse(localStorage.getItem("note_autosave_"+e)),n()):(u={name:t,id:e,content:"# "+t+"\nUnd hier dann der Text!!\n"},n())}l?(u={name:t,id:e,content:i},$("div.noteview div.loading").addClass("disable"),n()):($("div.noteview div.loading").removeClass("disable"),ajax_request("view",{userid:userinformation.id,noteid:e,history:2},function(e){$("div.noteview div.loading").addClass("disable"),"okay"===e.status?e.data.empty?a(!0):(u={name:e.data.name,id:e.data.id,content:e.data.content},n()):a(!1)},function(e){a(!1)}))}(),$("button#closenote").unbind("click").click(function(){cm_editor.off("change",c),cm_editor.off("change",g),l&&s?a(cm_editor.getValue(),!0):l?(window.location.hash="",loginsys()):!1===l&&o(function(e){e?list():($("body").append('<div id="errorMessageNoteSave">Die Speicherung der Notiz auf dem Server schlug fehl!<br />Wollen Sie den Editor verlassen und einen Verlust der Änderungen in Kauf nehmen oder abbrechen?</div>'),$("#errorMessageNoteSave").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:"Fehler beim Speichern!",buttons:{"Änderungen verwerfen":function(){$(this).dialog("close"),list()},Abbrechen:function(){$(this).dialog("close")}},close:function(){$(this).remove()}}))})}),l?($("button#publishnote").addClass("disable"),$("button#notehistory").addClass("disable")):($("button#publishnote").removeClass("disable"),$("button#notehistory").removeClass("disable"),$("button#publishnote").unbind("click").click(d),$("button#notehistory").unbind("click").click(r))}var cm_editor;function authCodeManager(){function e(e){$("div#authCodeManagerDialog").html(e)}function a(a){function s(e,a){var n=!1;if($("span#newPasswordAIndikator").css({color:"white"}),""==e&&($("span#newPasswordAIndikator").css({"background-color":"inherit"}),$("span#newPasswordAIndikator").text("Bitte geben Sie ein Passwort ein!"),n=!0),""==a&&($("span#newPasswordBIndikator").css({"background-color":"inherit"}),$("span#newPasswordBIndikator").text("Bitte geben Sie das Passwort ein!"),n=!0),""!=e){var s,o=e,t=e.length,d=0;t>5?((d+=5*(t-=5))>20&&(d=20),o.match(/([a-zA-Z])/)&&(d+=10),o.match(/([A-Z])/)&&(d+=5),o.match(/([0-9])/)&&(d+=5),o.match(/([0-9].*[0-9])/)&&(d+=10),o.match(/([0-9].*[0-9].*[0-9])/)&&(d+=10),o.match(/([!,%,&,@,#,*,?,_,])/)&&(d+=15),o.match(/([!,%,&,@,#,*,?,_,].*[!,%,&,@,#,*,?,_,])/)&&(d+=15),o.match(/([!,%,&,@,#,*,?,_,].*[!,%,&,@,#,*,?,_,].*[!,%,&,@,#,*,?,_,])/)&&(d+=15)):d=0,d<=25?(s="Das soll ein Passwort sein?",$("span#newPasswordAIndikator").css({"background-color":"red"})):d<=50?(s="Gut, aber es geht noch besser!",$("span#newPasswordAIndikator").css({"background-color":"orange"}),$("span#newPasswordAIndikator").css({color:"black"})):d<=75?(s="Das sieht doch super aus!",$("span#newPasswordAIndikator").css({"background-color":"yellow"}),$("span#newPasswordAIndikator").css({color:"black"})):d<=100&&(s="Da werden die Hacker schwitzen!",$("span#newPasswordAIndikator").css({"background-color":"green"})),$("span#newPasswordAIndikator").text(s)}return e!=a&&""!=e&&""!=a&&($("span#newPasswordBIndikator").css({"background-color":"red"}),$("span#newPasswordBIndikator").text("Die Passwörter stimmen nicht überein!"),n=!0),!n&&($("span#newPasswordBIndikator").css({"background-color":"green"}),$("span#newPasswordBIndikator").text("Passwörter stimmen überein!"),!0)}var o='<h3>Authentifizierungslinks</h3><div class="loading disable" id="authLinkLoading"></div>';!1!==a?(o+="<table><tr><th>Code (Anfang)</th><th>Letzte Nutzung</th><th>Löschen</th></tr>",a.forEach(function(e){o+='<tr><td><code style="color:black;">'+e.code+"</code></td><td>"+e.time+'</td><td><button class="deleteAuthLink" linkid="'+e.id+'" codeteil="'+e.code+'">Link Löschen</button></td></tr>'}),o+="</table>"):o+="<p>Sie haben noch keine Authentifizierungslinks!</p>",o+='<button id="addAuthLink">Neuen Link hinzufügen</button><p>&nbsp;</p>',e(o+='<h3>Passwort ändern</h3><div id="newPasswordLoader" class="loading disable"></div><input class="newPassword" type="password" id="newPasswordA" placeholder="Neues Passwort"> <span class="newPasswordIndikator" id="newPasswordAIndikator">Bitte geben Sie ein Passwort ein!</span><br /><input class="newPassword" type="password" id="newPasswordB" placeholder="Neues Passwort"> <span class="newPasswordIndikator" id="newPasswordBIndikator">Bitte geben Sie das Passwort ein!</span><br /><button id="newPasswordSet">Ändern</button><div id="newPasswordDone" class="disable"></div>'),$("button#newPasswordSet").prop("disabled",!0),$("span.newPasswordIndikator").css({"border-radius":"5px",padding:"2px"}),$("button#newPasswordSet").click(function(){var e=$("input#newPasswordA").val(),a=$("input#newPasswordB").val();if(!s(e,a))return!1;$("div#newPasswordLoader").removeClass("disable"),ajax_request("account",{userid:userinformation.id},function(a){if("okay"===a.status){var n=a.data,s=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(e));s=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(s+"+"+n)),ajax_request("account",{userid:userinformation.id,newpass:s,salt:n},function(e){$("div#newPasswordLoader").addClass("disable"),"okay"===e.status?($("div#newPasswordDone").removeClass("disable error"),$("div#newPasswordDone").addClass("okay"),$("div#newPasswordDone").text("Passwort geändert!")):($("div#newPasswordDone").removeClass("disable okay"),$("div#newPasswordDone").addClass("error"),$("div#newPasswordDone").text("Konnte Passwort nicht ändern!"))})}else $("div#newPasswordLoader").addClass("disable"),$("div#newPasswordDone").removeClass("disable okay"),$("div#newPasswordDone").addClass("error"),$("div#newPasswordDone").text("Konnte Passwort nicht ändern!")})}),$("input.newPassword").on("keyup",function(){s($("input#newPasswordA").val(),$("input#newPasswordB").val())?$("button#newPasswordSet").prop("disabled",!1):$("button#newPasswordSet").prop("disabled",!0)}),$("button.deleteAuthLink").click(function(){var e=$(this).attr("linkid"),a=$(this).attr("codeteil");confirm('Wollen sie den Code "'+a+'" wirklich löschen? ')&&($("div#authLinkLoading").removeClass("disable"),ajax_request("account",{userid:userinformation.id,art:"del",id:e},function(e){$("div#authLinkLoading").addClass("disable"),"okay"===e.status?n():alert("Konnte den Code nicht löschen!")}))}),$("button#addAuthLink").click(function(){$("div#authLinkLoading").removeClass("disable"),ajax_request("account",{userid:userinformation.id,art:"new",id:"new"},function(e){$("div#authLinkLoading").addClass("disable"),"okay"===e.status?(!function(e){var a=domain+"/#"+userinformation.name+":"+e,n='<p><b>Neuer Authentifizierungslink wurde erstellt:</b></p><p><b>Code:</b> <code style="color:black;">'+e+'</code></p><p><b>URL:</b> <input type="text" value="'+a+'" readonly="readonly" style="width:90%;"></p><p><b>Link:</b> <a href="'+a+'" target="_blank" style="color:lightblue;">Aufrufen</a></p><p><center><div style="background-color:white; padding:15px; border-radius:5px;" id="authCodeManagerNewCodeDialogQR"></div></center></p><p><em><u>Achtung:</u> Dieser Link und Code wird nur ein einziges Mal angezeigt!!</em></p>';$("body").append('<div id="authCodeManagerNewCodeDialog">'+n+"</div>"),$("div#authCodeManagerNewCodeDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:"Neuer Authentifizierungslink",close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}}),new QRCode(document.getElementById("authCodeManagerNewCodeDialogQR"),a)}(e.data),n()):alert("Konnte keinen Code erstellen!")})})}function n(){ajax_request("account",{userid:userinformation.id,art:"list",id:"list"},function(n){"okay"===n.status?a(n.data):e("Kann nicht laden!")})}$("body").append('<div id="authCodeManagerDialog">Lädt ...</div>'),$("div#authCodeManagerDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:"Authentifizierungslinks und Passwort",close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}}),n()}function oldNotesManager(){function t(t){t='<div id="oldNotesDialogLoader" class="loading disable"></div>'+t,$("div#oldNotesDialog").html(t)}$("body").append('<div id="oldNotesDialog"></div>'),$("div#oldNotesDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:"Notizarchiv",close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}}),t("Lädt ..."),$("div#oldNotesDialogLoader").removeClass("disable"),ajax_request("list",{userid:userinformation.id,reload:"none"},function(o){if($("div#oldNotesDialogLoader").addClass("disable"),"okay"===o.status){var e="<table><tr><th>Name</th><th>Zuletzt geändert</th><th>Wiederherstellen</th></tr>";o.data.forEach(function(t){e+="<tr><td>"+t.name+"</td><td>"+t.geaendert+'</td><td><button class="oldNotesDialogReload" noteid="'+t.noteid+'">&#x21bb;</button></td></tr>'}),t(e+="</table>"),$("button.oldNotesDialogReload").click(function(){var t=$(this).attr("noteid");$("div#oldNotesDialogLoader").removeClass("disable"),ajax_request("list",{userid:userinformation.id,reload:t},function(t){$("div#oldNotesDialogLoader").addClass("disable"),"okay"===t.status?(list(),$("div#oldNotesDialog").dialog("close")):alert("Konnte die Notiz nicht wiederherstellen!")})})}else t("Konnte nicht laden!!")})}function shareviewer(e,n){function t(){"function"==typeof n&&n()}ajax_request("share",{authcode:e},function(n){"okay"===n.status?n.data.edit?maker(n.data.id,n.data.name,n.data.content,function(n,t){function a(e){t&&(e&&!confirm("Konnte nicht Notiz speichern, trotzdem schließen?")||(window.location.hash="",loginsys()))}$("div.noteview div.loading").removeClass("disable"),ajax_request("share",{authcode:e,cont:n},function(e){$("div.noteview div.loading").addClass("disable"),"okay"===e.status||errorMessage("Konnten Notiz nicht speichern!"),a(!("okay"===e.status))},function(e){$("div.noteview div.loading").addClass("disable"),errorMessage("Konnte Notiz nicht speichern!"),a(!0)})}):maker(n.data.id,n.data.name,n.data.content):(errorMessage("Nachricht lässt sich mittels Freigabelink nicht öffnen.",!1),t())},function(e){t()})}