$(function(){loginsys()});var userinformation={"name":null,"id":null,"admin":!1};var errorMessageTimeOut=null;function review(enabled){$("div.login").addClass("disable");$("div.noteview").addClass("disable");$("div.noteslist").addClass("disable");$("div.globalloader").addClass("disable");$("div."+enabled).removeClass("disable")}
function errorMessage(message,remove){if(typeof remove=="undefined"){remove=10}
$("div.global.error.message").html(message);$("div.global.error.message").removeClass("disable");if(errorMessageTimeOut!==null){clearTimeout(errorMessageTimeOut)}
if(remove!==!1){errorMessageTimeOut=setTimeout(function(){$("div.global.error.message").addClass("disable")},remove*1000)}}
function ajax_request(task,post,callback,errcallback){$.post(domain+"/ajax.php?"+task,post,function(data){if(typeof data==="object"){if(data.status==='error'){console.log(data.error)}
else{errorMessage('',0)}
if(typeof callback==="function"){callback(data)}}
else{errorMessage('Sever antwortet nicht korrekt!',!1);if(typeof errcallback==="function"){errcallback(data)}}}).fail(function(){errorMessage('Verbindung zum Sever verloren!',!1);if(typeof errcallback==="function"){errcallback({})}})}
function loginsys(){function check_share(){review('globalloader');var authcode=window.location.hash;if(authcode!=""){authcode=authcode.substr(1);var expr=new RegExp('[^A-Za-z0-9]');if(!expr.test(authcode)){shareviewer(authcode,noshare)}
else{noshare()}}
else{noshare()}
function noshare(){review("login");loginlocalstorage()}}
check_share();function loginlocalstorage(){if(localStorage.getItem("userinformation_id")!=''&&localStorage.getItem("userinformation_id")!=null&&localStorage.getItem("userinformation_name")!=''&&localStorage.getItem("userinformation_name")!=null){userinformation.id=localStorage.getItem("userinformation_id");userinformation.name=localStorage.getItem("userinformation_name");userinformation.admin=JSON.parse(localStorage.getItem("userinformation_admin"));$("div.login div.input div.loading").removeClass("disable");ajax_request("login",{"status":userinformation.id},function(data){$("div.login div.input div.loading").addClass("disable");if(data.data==!0){logout_enable();list()}
else{loginlink()}})}
else{loginlink()}}
function loginlink(){var code=window.location.hash;if(code!=""){code=code.substr(1);var expr=new RegExp('[a-z]+:[a-z0-9]+');if(expr.test(code)){var parts=code.split(':');var user=parts[0];var auth=parts[1];console.log('Versuche User "'+user+'" mit Loginlink einzuloggen.');$("div.login div.input div.loading").removeClass("disable");ajax_request("login",{"username":user,"authcode":auth},function(data){$("div.login div.input div.loading").addClass("disable");if(data.status==='okay'){userinformation.name=user;userinformation.id=data.data.id;userinformation.admin=data.data.admin;localStorage.setItem("userinformation_id",userinformation.id);localStorage.setItem("userinformation_name",userinformation.name);localStorage.setItem("userinformation_admin",userinformation.admin);logout_enable();list()}
else{loginform()}})}
else{loginform()}}
else{loginform()}}
function loginform(){$("div.login p.message.important").removeClass("disable");$("div.login p.message.error").addClass("disable");$("div.login p.message.okay").addClass("disable");$("div.login div.input div.loading").addClass("disable");$("div.login div.input div#loginform").removeClass("disable");$("div.login div.input").removeClass("disable");$("button#userlogin").unbind("click").click(try_login);$("input#userpassword").unbind("keyup").keyup(function(event){if(event.keyCode==13){try_login()}});function try_login(){$("div.login div.input div.loading").removeClass("disable");$("div.login div.input div#loginform").addClass("disable");$("div.login p.message.important").addClass("disable");var hashedpw=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash($("input#userpassword").val()));ajax_request("login",{"username":$("input#username").val(),"password":hashedpw},function(data){$("div.login div.input div.loading").addClass("disable");if(data.status==='error'){$("div.login p.message.error").removeClass("disable");$("div.login div.input div#loginform").removeClass("disable")}
else if(data.status==='okay'){$("div.login p.message.okay").removeClass("disable");$("div.login p.message.error").addClass("disable");$("div.login div.input").addClass("disable");$("input#username").val("");$("input#userpassword").val("");userinformation.name=data.data.name;userinformation.id=data.data.id;userinformation.admin=data.data.admin;localStorage.setItem("userinformation_id",userinformation.id);localStorage.setItem("userinformation_name",userinformation.name);localStorage.setItem("userinformation_admin",userinformation.admin);logout_enable();list()}})}}
function logout_enable(){function display_and_listen(){$("div.logout").removeClass("disable");$("button#logout").unbind("click").click(do_logout)}
var keepAliveInterval=null;function do_logout(){ajax_request("login",{"logout":null},function(data){if(data.status==='okay'){$("p.message.error.loggedout").removeClass("disable");setTimeout(function(){$("p.message.error.loggedout").addClass("disable")},20000)}});if($("input#logouttype:checked").length==0){localStorage.clear()}
else{localStorage.removeItem("userinformation_id");localStorage.removeItem("userinformation_name")}
userinformation={"name":null,"id":null,"admin":!1};window.location.hash="";if(keepAliveInterval!==null){clearInterval(keepAliveInterval)}
errorMessage("Fehler!",0);if(typeof cm_editor!=="undefined"){cm_editor.setValue('empty')}['input#userpassword','input#username','input#notename','div#notespreview','textarea#notesinput','input#newnotename','div.listpart div.list'].forEach(function(v){$(v).empty();if(v!=='textarea#notesinput'){$(v).val('')}});$("div.logout").addClass("disable");loginsys()}
function keepSessionAlive(){keepAliveInterval=setInterval(function(){ajax_request("login",{"status":userinformation.id},function(data){if(data.data!=!0){errorMessage('Die Session ist abgelaufen!',!1)}})},300000)}
function adminButtons(){$("div.logout span.usertools").tooltip();if(userinformation.admin){$("div.logout span.usertools span.ui-icon-wrench").removeClass("disable");$("div.logout span.usertools span.ui-icon-wrench").unbind('click').click(function(){$.getScript(domain+"/load/backend."+jsdevmin+".js",function(){adminDialog()})})}
else{$("div.logout span.usertools span.ui-icon-wrench").addClass("disable")}
$("div.logout span.usertools span.ui-icon-person").unbind('click').click(function(){authCodeManager()})}
display_and_listen();keepSessionAlive();adminButtons()}}
function list(){review("noteslist");get_userdata();function get_userdata(){$("div.noteslist div.listpart div.loading").removeClass("disable");ajax_request("list",{"userid":userinformation.id},function(data){$("div.noteslist div.listpart div.loading").addClass("disable");if(data.status==='okay'){showlist(data.data)}})}
function showlist(notes){$("button#newnote").unbind("click").click(function(){var name=$("input#newnotename").val();if(name!=''){makenew(name)}});$("button#notesarchive").unbind("click").click(function(){oldNotesManager()});var table='<ul>';$.each(notes,function(k,v){table+='<li class="noteslist_notesnames box" noteid="'+v.noteid+'"><span class="notesnames">'+v.name+'</span> <span class="noteseditbuttons">'+'<button art="up" title="Nach oben" '+(k!=0?'':'disabled="disabled"')+'>&uarr;</button>'+'<button art="down" title="Nach unten" '+(notes.length-1!=k?'':'disabled="disabled"')+'>&darr;</button>'+'<button art="del" title="Notiz archivieren">&#x21bb;</button>'+'</span></li>'});table+='</ul>';$("div.noteslist div.listpart div.list").html(table);$("li.noteslist_notesnames").tooltip();$("div.noteslist div.listpart div.list ul").css({"list-style-type":"none"});$("div.noteslist div.listpart div.list ul li.noteslist_notesnames").css({"line-height":"28px"});$("span.noteseditbuttons").css({"float":"right","cursor":"pointer"});$("div.noteslist div.listpart div.list ul li span.notesnames").css({"display":"inline-block","cursor":"pointer"});$("div.noteslist div.listpart div.list ul li span.notesnames").unbind('click').click(function(){var noteid=$(this).parent().attr("noteid");var name=$(this).text();console.log('Oeffne: "'+name+'" ("'+noteid+'")');maker(noteid,name)});$("span.noteseditbuttons button").unbind("click").click(function(){var art=$(this).attr("art");var noteid=$(this).parent().parent().attr("noteid");$("div.noteslist div.listpart div.loading").removeClass("disable");ajax_request("list",{"userid":userinformation.id,"art":art,"noteid":noteid},function(data){$("div.noteslist div.listpart div.loading").addClass("disable");if(data.status==='okay'){console.log('Notiz: "'+noteid+'" wurde '+(art=='del'?'gelöscht':(art=='up'?'nach oben verschoben':'nach unten verschoben')));list()}})})}
function makenew(name){$("div.noteslist div.listpart div.loading").removeClass("disable");ajax_request("list",{"userid":userinformation.id,"name":name},function(data){$("div.noteslist div.listpart div.loading").addClass("disable");if(data.status==='okay'){console.log('Notiz: "'+name+'" ("'+data.data.id+'") angelegt.');list()}})}}
var cm_editor;function maker(noteid,notename,sharecont,savecallback){if(typeof sharecont==="undefined"){var share=!1;var shareeditable=!1}
else{if(typeof savecallback==="function"){var shareeditable=!0}
else{var shareeditable=!1}
var share=!0}
review("noteview");var notedata;var noteOverrideDanger=!1;function get_notedata(){function getDataWithoutServer(empty){if(!empty){noteOverrideDanger=!0;errorMessage('Kann die aktuelle Version der Notiz nicht vom Server holen.',20)}
if(localStorage.getItem("note_autosave_"+noteid)!=null){notedata=JSON.parse(localStorage.getItem("note_autosave_"+noteid));make_inputfield()}
else{notedata={"name":notename,"id":noteid,"content":"# "+notename+"\nUnd hier dann der Text!!\n"};make_inputfield()}}
if(share){notedata={"name":notename,"id":noteid,"content":sharecont};$("div.noteview div.loading").addClass("disable");make_inputfield()}
else{$("div.noteview div.loading").removeClass("disable");ajax_request("view",{"userid":userinformation.id,"noteid":noteid,"history":2},function(data){$("div.noteview div.loading").addClass("disable");if(data.status==='okay'){if(!data.data.empty){notedata={"name":data.data.name,"id":data.data.id,"content":data.data.content};make_inputfield()}
else{getDataWithoutServer(!0)}}
else{getDataWithoutServer(!1)}},function(data){getDataWithoutServer(!1)})}}
function closebutton(){$("button#closenote").unbind("click").click(function(){cm_editor.off("change",here_parser_reparse);cm_editor.off("change",here_codemi_save);if(share&&shareeditable){savecallback(cm_editor.getValue(),!0)}
else if(share){window.location.hash="";loginsys()}
else if(share===!1){ajaxsave(function(okay){if(okay){list()}
else{$("body").append('<div id="errorMessageNoteSave">Die Speicherung der Notiz auf dem Server schlug fehl!<br />Wollen Sie den Editor verlassen und einen Verlust der Änderungen in Kauf nehmen oder abbrechen?</div>');$("#errorMessageNoteSave").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:'Fehler beim Speichern!',buttons:{"Änderungen verwerfen":function(){$(this).dialog("close");list()},"Abbrechen":function(){$(this).dialog("close")}},close:function(){$(this).remove()}})}})}});if(share){$("button#publishnote").addClass('disable');$("button#notehistory").addClass('disable')}
else{$("button#publishnote").removeClass('disable');$("button#notehistory").removeClass('disable');$("button#publishnote").unbind('click').click(freigabeManager);$("button#notehistory").unbind('click').click(historyManager)}}
var here_parser_reparse,here_codemi_save;function make_inputfield(){$("input#notename").val(notedata.name);$("textarea#notesinput").text(notedata.content);if(typeof cm_editor!=="object"){cm_editor=CodeMirror.fromTextArea(document.getElementById("notesinput"),{mode:'gfm',lineNumbers:!0,theme:"default"})}
else{cm_editor.setValue($("textarea#notesinput").val())}
load_parser_preview();autosave_changes()}
function load_parser_preview(){var markRend=new marked.Renderer();markRend.heading=function(text,level){return '<h'+(level+2)+'>'+text+'</h'+(level+2)+'>'}
markRend.link=function(href,title,text){return '<a href="'+href+'" title="'+title+'" target="_blank">'+text+'</a>'}
marked.setOptions({renderer:markRend,gfm:!0,tables:!0,highlight:function(code,lang){var prismlanguages=['markup','css','clike','javascript','c','bash','cpp','csharp','ruby','git','ini','java','json','lua','markdown','matlab','objectivec','perl','php','python','r','sql','swift'];if(lang=='tex'){try{return katex.renderToString(code)}catch(e){return '<span style="color:red;">'+e.message+'</span>'}}
else if(prismlanguages.indexOf(lang)!==-1){return Prism.highlight(code,Prism.languages[lang])}
else{return code}}});function reparse(instance,change){var isSafariOrWebview=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent);if(isSafariOrWebview&&typeof change!=="undefined"){if(change.text.length===1&&(/^[A-Z]$/).test(change.text[0])){var focused=$(':focus');focused.blur();focused.focus()}}
$("div#notespreview").html(marked(cm_editor.getValue()))}
reparse();if(share&&!shareeditable){$("div.input.box").addClass('disable')}
else{$("div.input.box").removeClass('disable');cm_editor.on("change",reparse)}
here_parser_reparse=reparse}
var lastajaxsave=0;function autosave_changes(){function save(){var savedata={"name":$("input#notename").val(),"id":notedata.id,"content":cm_editor.getValue()};localStorage.setItem("note_autosave_"+notedata.id,JSON.stringify(savedata));if(Date.now()-(30*1000)>lastajaxsave){ajaxsave()}}
save();cm_editor.on("change",save);here_codemi_save=save}
function ajaxsave(callback){if(noteOverrideDanger){$("body").append('<div id="dangerMessageNoteSave">Beim Speichern der Notiz kann es eventuell zu Datenverlust kommen, da die aktuellste Version nicht vom Server geladen werden konnte!</div>');$("#dangerMessageNoteSave").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:'Gefahr des Datenverlustes!',buttons:{"Trotzdem Speichern":function(){$(this).dialog("close");noteOverrideDanger=!1;doSave()},"Erstmal nicht":function(){$(this).dialog("close")}},close:function(){$(this).remove()}})}
else{doSave()}
function doSave(){if(share&&shareeditable){lastajaxsave=Date.now();savecallback(cm_editor.getValue(),!1)}
else if(share===!1){$("div.noteview div.loading").removeClass("disable");ajax_request("view",{"userid":userinformation.id,"noteid":noteid,"note":{"name":$("input#notename").val(),"cont":cm_editor.getValue()}},function(data){$("div.noteview div.loading").addClass("disable");if(data.status==='okay'){console.log('Notiz: "'+notename+'" ("'+noteid+'") auf Server gespeichert.');lastajaxsave=Date.now()}
if(typeof callback==="function"){callback((data.status==='okay'))}},function(data){if(typeof callback==="function"){callback(!1)}})}}}
get_notedata();closebutton();function freigabeManager(){function errorOnLoading(){errorMessage('Freigaben konnten nicht geladen werden.');$("div.noteview div.loading").addClass("disable")}
$("div.noteview div.loading").removeClass("disable");ajax_request("view",{"userid":userinformation.id,"noteid":noteid},function(data){if(data.status==='okay'){var html='<div class="message error freigabeDialog disable">Konnte Aktion nicht durchführen.</div>'+'<table><tr><th>Link</th><th>Name</th><th>Erstellt</th><th>Bearbeiten</th><th>Letzter Aufruf (Anzahl)</th><th>Löschen</th></tr>';var inhalt=!1;$.each(data.data,function(k,v){inhalt=!0;html+='<tr><td><a href="'+domain+'/#'+v.authcode+'" target="_blank" style="color:lightblue;">Aufrufen</a> <button authcode="'+v.authcode+'" class="freigabeQR">QR-Code</button></td>';html+='<td>'+v.name+'</td>';html+='<td>'+v.created+'</td>';html+='<td><code style="color:black;">'+v.edit+'</code></td>';html+='<td>'+v.lastAccessed+' ('+v.accesses+')</td>';html+='<td><button authcode="'+v.authcode+'" class="deleteFreigabe">Löschen</button></td></tr>'});html+='</table>';if(inhalt===!1){html+='<p>Noch keine Freigaben!</p>'}
html+='<h3>Neue Freigabe</h3>'+'<div class="loading freigabeDialog disable"></div>'+'<input type="text" placeholder="Name" id="freigabeManagerNewName"><br />'+'<input type="radio" id="freigabeManagerNewEdit" name="freigabeManagerNewEdit" value="true"> true '+'<input type="radio" id="freigabeManagerNewEdit" name="freigabeManagerNewEdit" value="false" checked="checked"> false <br />'+'<button id="addFreigabe">Erstellen</button>';$("body").append('<div id="freigabeManagerDialog">'+html+'</div>');$("div.noteview div.loading").addClass("disable");$("div#freigabeManagerDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:'Freigaben',close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}});$("button.deleteFreigabe").click(function(){var authcode=$(this).attr('authcode');$("div.freigabeDialog.loading").removeClass('disable');ajax_request("view",{"userid":userinformation.id,"noteid":noteid,"share":{"authcode":authcode,"edit":"leer","name":"leer"}},function(data){if(data.status==='okay'){$("div#freigabeManagerDialog").dialog('close');freigabeManager()}
else{$("div.freigabeDialog.loading").addClass('disable');$("div.freigabeDialog.error").removeClass('disable')}})});$("button#addFreigabe").click(function(){var name=$("input#freigabeManagerNewName").val();var edit=($("input#freigabeManagerNewEdit:checked").val()=='true'?!0:!1);if(name==''){return}
$("div.freigabeDialog.loading").removeClass('disable');ajax_request("view",{"userid":userinformation.id,"noteid":noteid,"share":{"authcode":"leer","edit":edit,"name":name}},function(data){if(data.status==='okay'){$("div#freigabeManagerDialog").dialog('close');freigabeManager()}
else{$("div.freigabeDialog.loading").addClass('disable');$("div.freigabeDialog.error").removeClass('disable')}})});$("button.freigabeQR").click(function(){var code=$(this).attr('authcode');var authlink=domain+'/#'+code;var html='<p><b>Code:</b> <code style="color:black;">'+code+'</code></p>'+'<p><b>URL:</b> <input type="text" value="'+authlink+'" readonly="readonly" style="width:90%;"></p>'+'<p><b>Link:</b> <a href="'+authlink+'" target="_blank" style="color:lightblue;">Aufrufen</a></p>'+'<p><center><div style="background-color:white; padding:15px; border-radius:5px;" id="freigabeManagerQR"></div></center></p>';$("body").append('<div id="freigabeManagerQRDialog">'+html+'</div>');$("div#freigabeManagerQRDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:'Freigabelink',close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}});new QRCode(document.getElementById("freigabeManagerQR"),authlink)})}
else{errorOnLoading()}},errorOnLoading)}
function historyManager(){function errorOnLoading(){errorMessage('Notizverlauf konnte nicht geladen werden.');$("div.noteview div.loading").addClass("disable")}
$("div.noteview div.loading").removeClass("disable");ajax_request("view",{"userid":userinformation.id,"noteid":noteid,"history":3},function(data){if(data.status==='okay'){var html='<table><tr><th>Änderungen</th><th>Zeitpunkt</th></tr>';$.each(data.data,function(k,v){html+='<tr><td>'+v.diff+'</td>';html+='<td>'+v.time+'<button key="'+k+'" class="takeInputFromHistory">Zurückkehren</button></td></tr>'});html+='</table>';$("body").append('<div id="historyManagerDialog">'+html+'</div>');$("div.noteview div.loading").addClass("disable");$("div#historyManagerDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:'Notizverlauf',close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}});$("button.takeInputFromHistory").click(function(){var key=$(this).attr('key');var newtext=data.data[key].text;cm_editor.setValue(newtext);$("div#historyManagerDialog").dialog("close")})}
else{errorOnLoading()}},errorOnLoading)}}
function authCodeManager(){function initDialog(){$("body").append('<div id="authCodeManagerDialog">Lädt ...</div>');$("div#authCodeManagerDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:'Authentifizierungslinks und Passwort',close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}})}
function dialogSetContent(cont){$("div#authCodeManagerDialog").html(cont)}
function loadContent(authcodes){var html='<h3>Authentifizierungslinks</h3>'+'<div class="loading disable" id="authLinkLoading"></div>';if(authcodes!==!1){html+='<table>'+'<tr>'+'<th>Code (Anfang)</th>'+'<th>Letzte Nutzung</th>'+'<th>Löschen</th>'+'</tr>';authcodes.forEach(function(value){html+='<tr>'+'<td><code style="color:black;">'+value.code+'</code></td>'+'<td>'+value.time+'</td>'+'<td><button class="deleteAuthLink" linkid="'+value.id+'" codeteil="'+value.code+'">Link Löschen</button></td>'+'</tr>'});html+='</table>'}
else{html+='<p>Sie haben noch keine Authentifizierungslinks!</p>'}
html+='<button id="addAuthLink">Neuen Link hinzufügen</button>'+'<p>&nbsp;</p>';html+='<h3>Passwort ändern</h3>'+'<div id="newPasswordLoader" class="loading disable"></div>'+'<input class="newPassword" type="password" id="newPasswordA" placeholder="Neues Passwort"> <span class="newPasswordIndikator" id="newPasswordAIndikator">Bitte geben Sie ein Passwort ein!</span><br />'+'<input class="newPassword" type="password" id="newPasswordB" placeholder="Neues Passwort"> <span class="newPasswordIndikator" id="newPasswordBIndikator">Bitte geben Sie das Passwort ein!</span><br />'+'<button id="newPasswordSet">Ändern</button>'+'<div id="newPasswordDone" class="disable"></div>';dialogSetContent(html);$("button#newPasswordSet").prop('disabled',!0);$("span.newPasswordIndikator").css({'border-radius':'5px','padding':'2px'});$("button#newPasswordSet").click(function(){var pA=$("input#newPasswordA").val();var pB=$("input#newPasswordB").val();if(testPasswords(pA,pB)){$("div#newPasswordLoader").removeClass("disable");ajax_request("account",{userid:userinformation.id},function(data){if(data.status==='okay'){var salt=data.data;var password=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(pA));password=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(password+"+"+salt));ajax_request("account",{userid:userinformation.id,newpass:password,salt:salt},function(data){$("div#newPasswordLoader").addClass("disable");if(data.status==='okay'){$("div#newPasswordDone").removeClass("disable error");$("div#newPasswordDone").addClass("okay");$("div#newPasswordDone").text("Passwort geändert!")}
else{$("div#newPasswordDone").removeClass("disable okay");$("div#newPasswordDone").addClass("error");$("div#newPasswordDone").text("Konnte Passwort nicht ändern!")}})}
else{$("div#newPasswordLoader").addClass("disable");$("div#newPasswordDone").removeClass("disable okay");$("div#newPasswordDone").addClass("error");$("div#newPasswordDone").text("Konnte Passwort nicht ändern!")}})}
else{return!1}});$("input.newPassword").on('keyup',function(){var pA=$("input#newPasswordA").val();var pB=$("input#newPasswordB").val();if(testPasswords(pA,pB)){$("button#newPasswordSet").prop('disabled',!1)}
else{$("button#newPasswordSet").prop('disabled',!0)}});$("button.deleteAuthLink").click(function(){var codeid=$(this).attr('linkid');var codeteil=$(this).attr('codeteil');if(confirm('Wollen sie den Code "'+codeteil+'" wirklich löschen? ')){$("div#authLinkLoading").removeClass("disable");ajax_request("account",{userid:userinformation.id,art:'del',id:codeid},function(data){$("div#authLinkLoading").addClass("disable");if(data.status==='okay'){fillDialog()}
else{alert('Konnte den Code nicht löschen!')}})}});$("button#addAuthLink").click(function(){$("div#authLinkLoading").removeClass("disable");ajax_request("account",{userid:userinformation.id,art:'new',id:'new'},function(data){$("div#authLinkLoading").addClass("disable");if(data.status==='okay'){showNewCode(data.data);fillDialog()}
else{alert('Konnte keinen Code erstellen!')}});function showNewCode(code){var authlink=domain+'/#'+userinformation.name+':'+code;var html='<p><b>Neuer Authentifizierungslink wurde erstellt:</b></p>'+'<p><b>Code:</b> <code style="color:black;">'+code+'</code></p>'+'<p><b>URL:</b> <input type="text" value="'+authlink+'" readonly="readonly" style="width:90%;"></p>'+'<p><b>Link:</b> <a href="'+authlink+'" target="_blank" style="color:lightblue;">Aufrufen</a></p>'+'<p><center><div style="background-color:white; padding:15px; border-radius:5px;" id="authCodeManagerNewCodeDialogQR"></div></center></p>'+'<p><em><u>Achtung:</u> Dieser Link und Code wird nur ein einziges Mal angezeigt!!</em></p>';$("body").append('<div id="authCodeManagerNewCodeDialog">'+html+'</div>');$("div#authCodeManagerNewCodeDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:'Neuer Authentifizierungslink',close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}});new QRCode(document.getElementById("authCodeManagerNewCodeDialogQR"),authlink)}});function testPasswords(pA,pB){var error=!1;$("span#newPasswordAIndikator").css({'color':'white'});if(pA==""){$("span#newPasswordAIndikator").css({'background-color':'inherit'});$("span#newPasswordAIndikator").text('Bitte geben Sie ein Passwort ein!');error=!0}
if(pB==""){$("span#newPasswordBIndikator").css({'background-color':'inherit'});$("span#newPasswordBIndikator").text('Bitte geben Sie das Passwort ein!');error=!0}
if(pA!=""){var inputval=pA
var inputvallen=pA.length;var passbarval=0;var text;if(inputvallen>5){inputvallen=inputvallen-5;passbarval+=inputvallen*5;if(passbarval>20){passbarval=20}
if(inputval.match(/([a-zA-Z])/)){passbarval+=10}
if(inputval.match(/([A-Z])/)){passbarval+=5}
if(inputval.match(/([0-9])/)){passbarval+=5}
if(inputval.match(/([0-9].*[0-9])/)){passbarval+=10}
if(inputval.match(/([0-9].*[0-9].*[0-9])/)){passbarval+=10}
if(inputval.match(/([!,%,&,@,#,*,?,_,])/)){passbarval+=15}
if(inputval.match(/([!,%,&,@,#,*,?,_,].*[!,%,&,@,#,*,?,_,])/)){passbarval+=15}
if(inputval.match(/([!,%,&,@,#,*,?,_,].*[!,%,&,@,#,*,?,_,].*[!,%,&,@,#,*,?,_,])/)){passbarval+=15}}
else{passbarval=0}
if(passbarval<=25){text="Das soll ein Passwort sein?";$("span#newPasswordAIndikator").css({'background-color':'red'})}
else if(passbarval<=50){text="Gut, aber es geht noch besser!";$("span#newPasswordAIndikator").css({'background-color':'orange'});$("span#newPasswordAIndikator").css({'color':'black'})}
else if(passbarval<=75){text="Das sieht doch super aus!";$("span#newPasswordAIndikator").css({'background-color':'yellow'});$("span#newPasswordAIndikator").css({'color':'black'})}
else if(passbarval<=100){text="Da werden die Hacker schwitzen!";$("span#newPasswordAIndikator").css({'background-color':'green'})}
$("span#newPasswordAIndikator").text(text)}
if(pA!=pB&&pA!=""&&pB!=""){$("span#newPasswordBIndikator").css({'background-color':'red'});$("span#newPasswordBIndikator").text('Die Passwörter stimmen nicht überein!');error=!0}
if(!error){$("span#newPasswordBIndikator").css({'background-color':'green'});$("span#newPasswordBIndikator").text('Passwörter stimmen überein!');return!0}
else{return!1}}}
initDialog();function fillDialog(){ajax_request("account",{userid:userinformation.id,art:'list',id:'list'},function(data){if(data.status==='okay'){loadContent(data.data)}
else{dialogSetContent('Kann nicht laden!')}})}
fillDialog()}
function oldNotesManager(){function loadDialog(){$("body").append('<div id="oldNotesDialog"></div>');$("div#oldNotesDialog").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,title:'Notizarchiv',close:function(){$(this).remove()},position:{my:"center",at:"center",of:$("div.main")}});setHTML('Lädt ...')}
function setHTML(h){h='<div id="oldNotesDialogLoader" class="loading disable"></div>'+h;$("div#oldNotesDialog").html(h)}
function loadList(){$("div#oldNotesDialogLoader").removeClass("disable");ajax_request('list',{userid:userinformation.id,reload:'none'},function(data){$("div#oldNotesDialogLoader").addClass("disable");if(data.status==="okay"){var html='<table>'+'<tr>'+'<th>Name</th>'+'<th>Zuletzt geändert</th>'+'<th>Wiederherstellen</th>'+'</tr>';data.data.forEach(function(value){html+='<tr>'+'<td>'+value.name+'</td>'+'<td>'+value.geaendert+'</td>'+'<td><button class="oldNotesDialogReload" noteid="'+value.noteid+'">&#x21bb;</button></td>'+'</tr>'});html+='</table>';setHTML(html);$("button.oldNotesDialogReload").click(function(){var noteid=$(this).attr('noteid');$("div#oldNotesDialogLoader").removeClass("disable");ajax_request('list',{userid:userinformation.id,reload:noteid},function(data){$("div#oldNotesDialogLoader").addClass("disable");if(data.status==="okay"){list();$("div#oldNotesDialog").dialog("close")}
else{alert('Konnte die Notiz nicht wiederherstellen!')}})})}
else{setHTML('Konnte nicht laden!!')}})}
loadDialog();loadList()}
function shareviewer(authcode,errorcallback){ajax_request('share',{"authcode":authcode},function(data){if(data.status==="okay"){if(data.data.edit){maker(data.data.id,data.data.name,data.data.content,function(newcont,close){$("div.noteview div.loading").removeClass("disable");ajax_request('share',{"authcode":authcode,"cont":newcont},function(data){$("div.noteview div.loading").addClass("disable");if(data.status==="okay"){}
else{errorMessage("Konnten Notiz nicht speichern!")}
doClose(!(data.status==="okay"))},function(data){$("div.noteview div.loading").addClass("disable");errorMessage("Konnten Notiz nicht speichern!");doClose(!0)});function doClose(error){if(close){if(!error||confirm("Konnte nicht Notiz speichern, trotzdem schließen?")){window.location.hash="";loginsys()}}}})}
else{maker(data.data.id,data.data.name,data.data.content)}}
else{errorMessage("Nachricht lässt sich mittels Freigabelink nicht öffnen.",!1);shareerror()}},function(data){shareerror()});function shareerror(){if(typeof errorcallback==="function"){errorcallback()}}}